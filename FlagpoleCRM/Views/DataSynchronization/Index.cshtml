@{
    Layout = "/Views/Shared/_Layout.cshtml";
}

<style>
    .web-sync-logo {
        width: 48px;
        height: 48px;
    }
    .sync-modal {
        max-width: 1300px;
    }
    .sync-input {
        width: 40%;
        padding-right: 20px;
        border-right: 1px #5c5c5c solid;
    }
    .sync-tutorial {
        width: 60%;
        overflow-y: scroll;
        padding-left: 20px;
        max-height: 450px;
    }
    .align-text-center {
        text-align: center;
    }
    .sync-tutorial-img {
        max-height: 300px;
        margin-bottom: 20px;
    }
</style>

<main class="page-content">
    <div class="breadcrumb-title pe-3">Data Synchronization</div>
    <hr>
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xl-6 row-cols-xxl-6">
        <div class="col">
            <div class="card radius-10" style="background-color:#1B67A3">
                <div class="card-body text-center">
                    <div class="widget-icon mx-auto mb-3 bg-white-1 text-white" data-bs-toggle="modal" data-bs-target="#haravan-setting">
                        <img src="/img/other-logos/haravan-logo.jpg" class="web-sync-logo"/>
                    </div>
                    <h3 class="text-white">Haravan</h3>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card radius-10" style="background-color: #5E8D3E">
                <div class="card-body text-center">
                    <div class="widget-icon mx-auto mb-3 bg-white-1 text-white" data-bs-toggle="modal" data-bs-target="#shopify-setting">
                        <img src="/img/other-logos/shopify-logo.jpg" class="web-sync-logo" />
                    </div>
                    <h3 class="text-white">Shopify</h3>
                </div>
            </div>
        </div>
    </div><!--end row-->

    <div class="modal fade" id="haravan-setting" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered sync-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sync data from Haravan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="display:flex">
                    <div class="sync-input">
                        <label>Access token:</label>
                        <input type="text" class="form-control" placeholder="Your access token" id="haravan-access-token"/>
                    </div>
                    <div class="sync-tutorial">
                        <h5 class="align-text-center">How to get <b>Access token</b>?</h5>
                        <p><b>Step 1:</b> Click on <i>Apps</i> on your sidebar and choose <i>Private apps</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/haravan-tutorial/step-1.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 2:</b> Choose <i>Create private app</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/haravan-tutorial/step-2(2).png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 3:</b> Enter app name and grant Admin API permissions, then click <i>Create private apps</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/haravan-tutorial/step-3.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 4:</b> Retrieve access token</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/haravan-tutorial/step-4.png" class="sync-tutorial-img" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-haravan-setting">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="shopify-setting" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered sync-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sync data from Shopify</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="display:flex">
                    <div class="sync-input">
                        <label>Access token:</label>
                        <input type="text" class="form-control" placeholder="Your access token" id="shopify-access-token"/>
                        <label style="margin-top:15px">Shop domain:</label>
                        <input type="text" class="form-control" placeholder="Your shop domain" id="shopify-shop-domain"/>
                    </div>
                    <div class="sync-tutorial">
                        <h5 class="align-text-center">How to get <b>Access token</b> and <b>Shop domain</b>?</h5>
                        <p><b>Step 1:</b> Click on <i>Apps</i> on your sidebar</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/click-on-apps.png" class="sync-tutorial-img"/>
                        </div>
                        <p><b>Step 2:</b> Choose <i>App and sales channel settings</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/choose-app-and-sale.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 3:</b> Choose <i>Develop apps</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/choose-develope-app.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 4:</b> Click on <i>Create an app</i> button</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/click-create-an-app.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 5:</b> Fill in required fields and create app</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/create-app.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 6:</b> Choose <i>Configure Admin API scope</i></p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/config-scope.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 7:</b> Allow below access scopes</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/scope-list.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 8:</b> Install your app</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/install-app.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 9:</b> Retrieve access token</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/get-access-token.png" class="sync-tutorial-img" />
                        </div>
                        <p><b>Step 10:</b> Retrieve your shop domain</p>
                        <div class="align-text-center">
                            <img src="~/img/tutorial/shopify-tutorial/get-shop-domain.png" class="sync-tutorial-img" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-shopify-setting">Save changes</button>
                </div>
            </div>
        </div>
    </div>
</main>

@section Script {
    <script>
        $(document).ready(function() {
            getEcommerceToken();
        })

        $('#save-haravan-setting').click(function() {
            var currentWebsite = ''
            var haravanToken = $('#haravan-access-token').val();
            if (!haravanToken) {
                toastr_call('error', 'Error', 'Haravan access token could not be blank!');
            }
            else {
                saveAccessToken(haravanToken, '@Common.Constant.DataSource.HARAVAN', null, '@Common.Constant.CookiesName.CURRENT_WEBSITE');
            }
        })

        $('#save-shopify-setting').click(function() {
            var shopifyToken = $('#shopify-access-token').val();
            var shopifyShopDomain = $('#shopify-shop-domain').val();
            if (!shopifyShopDomain || !shopifyToken) {
                toastr_call('error', 'Error', 'Shopify access token and shop domain could not be blank!');
            }
            else {
                saveAccessToken(shopifyToken, '@Common.Constant.DataSource.SHOPIFY', shopifyShopDomain, '@Common.Constant.CookiesName.CURRENT_WEBSITE');
            }
        })

        function saveAccessToken(token, dataSource, shopDomain, currentWebsite) {
            $('.loading').css('display', 'block');
            var websiteId = localStorage.getItem(currentWebsite);
            $.ajax({
                url: `@Url.Action("SaveAccessToken", "DataSynchronization")`,
                type: 'post',
                data: {
                    token: token,
                    dataSource: dataSource,
                    shopDomain: shopDomain,
                    websiteId: websiteId
                },
                success: (result) => {
                    $('.loading').css('display', 'none');
                    if (!result.isSuccessful) {
                        toastr_call('error', 'Error', result.message);
                    }
                    else {
                        toastr_call('success', 'Success', 'Update successfully!');
                    }
                }
            })
        }

        function getEcommerceToken() {
            $.ajax({
                url: `@Url.Action("GetWebsiteById", "DataSynchronization")?id=${localStorage.getItem('@Common.Constant.CookiesName.CURRENT_WEBSITE')}`,
                type: 'get',
                success: (result) => {
                    if (result == null) return;
                    if (result.shopifyToken) {
                        $('#shopify-access-token').val(result.shopifyToken);
                    }
                    else {
                        $('#shopify-access-token').val('');
                    }
                    if (result.shopifyStore) {
                        $('#shopify-shop-domain').val(result.shopifyStore);
                    }
                    else {
                        $('#shopify-shop-domain').val('');
                    }
                    if (result.haravanToken) {
                        $('#haravan-access-token').val(result.haravanToken);
                    }
                    else {
                        $('#haravan-access-token').val('');
                    }
                }
            })
        }

        $('#choose-websites').change(function () {
            getEcommerceToken();
        })
        
    </script>
}
